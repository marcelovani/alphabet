/*
 *  Alphabet
 */
(function ($) {
	'use strict';

	var language = 'en-US';
	var voice = null;
	var sound = null;

	var change_sound = function (language) {
		sound = new Howl({
			urls: ['sounds/' + language + '/' + voice + '/alphabet.mp3'],
			sprite: alphabetJson.language[language].voice[voice].sprite,
			autoplay: false,
			loop: false,
			onend: function() {
				//show_picture();
				//console.log('sp');
			}
		});
	};

	var show_picture = function (character) {
		var mediaMap = mediaMapJson.language[language].voice[voice][character.toLowerCase()];
		var chosen = 0; //@todo use random to pic one of multiple words if available.

		$('#picture .preview img').attr('src', 'images/pictures/' + mediaMap[chosen]['picture']);
		$('#picture .caption').html(mediaMap[chosen]['word']);

		var effect = new Howl({
			urls: ['sounds/effects/' + mediaMap[chosen]['effect']],
			onend: function() {
				$('#picture').fadeOut();
			}
		});

		var spoken = new Howl({
			urls: ['sounds/' + language + '/' + voice + '/' + mediaMap[chosen]['spoken']],
			onend: function() {
				effect.play();
			}
		});
		spoken.play();

		$('#picture').show();
	};

	var set_language = function (lang) {
		language = lang;
		$('body').removeClass();
		$('body').addClass(language.toLowerCase());

		change_sound(language);
	};

	var set_voice = function (person) {
		voice = person;
		change_sound(language);
	};

	var set_characters = function (type) {
		// Clean buttons.
		$('.character').remove();

		switch (type) {
			case 'letters':
				var chars = (function () {
					var output = [];
					for (var i = 'A'.charCodeAt(0); i <= 'Z'.charCodeAt(0); i++)
						output.push(String.fromCharCode(i));
					return output;
				})();
				break;

			case 'numbers':
				var chars = (function () {
					var output = [];
					for (var i = '1'; i <= '9'; i++)
						output.push(String(i));
					output.push(String(0));
					return output;
				})();
				break;
		}

		var i = 0;
		$.each(chars, function (b, val) {
			// Change background colors.
			if (i <= 5) {
				i++;
			}
			else {
				i = 1;
			}

			var html = '<span class="character ' + val + ' c' + i + '">' + val + '</span>';
			$('#characters').append(html).find('.character.' + val).touchstart(function (i) {
				$(this).hide().fadeIn('fast', function () {
					button_clicked(this.innerHTML);
				});
			});

		});
	};

	var button_clicked = function (character) {
		//console.log(sound);
		// Override onend().
		sound._onend[0] = function() {
			show_picture(character);
		}
		//console.log(sound);
		sound.play(character.toLowerCase(), function () {
			// change picture depending on letter;
		});
	};

	var init = function () {
		$(document).ready(function () {
			set_characters('letters');
			set_voice('ann');
			set_language('pt-BR');

			// Picture preview close.
			$('#picture .back').click(function () {
				$('#picture').hide();
			});

			// Settings page.
			$('.setting-button').click(function () {
				$('#characters').hide();
				$('#settings').show();
			});

			$('.close-settings-button').click(function () {
				$('#characters').show();
				$('#settings').hide();
			});

			$('input:radio').change(
				function () {
					switch (this.name) {
						case 'language':
							set_language(this.value);
							break;

						case 'voice':
							set_voice(this.value);
							break;

						case 'characters':
							set_characters(this.value);
							break;
					}
				}
			);
		});
	};

	init();

})(jQuery);
